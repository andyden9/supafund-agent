=========================================
æµè§ˆå™¨ä¿®å¤è„šæœ¬ - ç›´æ¥å¤åˆ¶ç²˜è´´
=========================================

åœ¨ http://localhost:3000 çš„æµè§ˆå™¨æ§åˆ¶å°ï¼Œå¤åˆ¶ç²˜è´´ä¸‹é¢çš„å®Œæ•´è„šæœ¬ï¼š


=========================================
è„šæœ¬å¼€å§‹ï¼ˆåŒ…æ‹¬è¿™ä¸€è¡Œä¸€èµ·å¤åˆ¶ï¼‰
=========================================
(async function fixPearl() {
  console.log('ğŸ”§ Pearl Frontend Fix Script');
  console.log('='.repeat(60));
  console.log('');

  // Step 1: Verify backend
  console.log('1ï¸âƒ£ Verifying backend...');
  try {
    const services = await fetch('http://localhost:8000/api/v2/services').then(r => r.json());
    console.log(`   âœ… Backend works! Found ${services.length} service(s)`);

    if (services.length > 0) {
      const service = services[0];
      console.log('   Service:', service.name, service.service_config_id);

      // Step 2: Set service in localStorage
      console.log('');
      console.log('2ï¸âƒ£ Setting service in localStorage...');
      localStorage.setItem('pearl_store_selectedService', JSON.stringify(service));
      localStorage.setItem('pearl_store_isUserLoggedIn', 'true');
      console.log('   âœ… Service selected');

      // Step 3: Check if QueryClient exists
      console.log('');
      console.log('3ï¸âƒ£ Checking React Query...');

      if (!window.queryClient) {
        console.log('   âš ï¸ QueryClient not exposed to window');
        console.log('   This is normal - it is in React context');
      } else {
        console.log('   âœ… QueryClient accessible');
        const queries = window.queryClient.getQueryCache().getAll();
        console.log(`   Current queries: ${queries.length}`);
      }

      // Step 4: The KEY FIX - Reload to reinitialize providers
      console.log('');
      console.log('4ï¸âƒ£ Reloading page to reinitialize providers...');
      console.log('   This will:');
      console.log('   - Reload with service selected');
      console.log('   - Reload with logged in state');
      console.log('   - Trigger all queries to start');
      console.log('');
      console.log('ğŸ”„ Reloading in 2 seconds...');

      setTimeout(() => {
        window.location.reload();
      }, 2000);

    } else {
      console.log('   âŒ No services found in backend');
      console.log('   Create a service first from the UI');
    }

  } catch (error) {
    console.log('   âŒ Backend error:', error.message);
    console.log('   Make sure daemon is running: ./start_pearl_daemon.sh');
  }
})();
=========================================
è„šæœ¬ç»“æŸï¼ˆåŒ…æ‹¬è¿™ä¸€è¡Œä¸€èµ·å¤åˆ¶ï¼‰
=========================================


ç­‰å¾…é¡µé¢é‡æ–°åŠ è½½ï¼ˆçº¦5ç§’ï¼‰ï¼Œç„¶åæ£€æŸ¥ï¼š

1. æŒ‰é’®æ˜¯å¦å˜æˆå¯ç‚¹å‡»ï¼Ÿ
2. å¦‚æœè¿˜æ˜¯ç°è‰²ï¼Œå†æ¬¡è¿è¡Œè¿™ä¸ªå‘½ä»¤æŸ¥çœ‹æŸ¥è¯¢æ•°é‡ï¼š

window.queryClient?.getQueryCache().getAll().length

å¦‚æœè¿˜æ˜¯0ï¼Œè¯·è¿è¡Œä¸‹é¢çš„é«˜çº§è¯Šæ–­ï¼š


=========================================
é«˜çº§è¯Šæ–­ï¼ˆå¦‚æœä¸Šé¢çš„ä¿®å¤æ— æ•ˆï¼‰
=========================================

(function() {
  console.log('ğŸ” Checking why queries are not running...');

  // Check all provider conditions
  console.log('');
  console.log('Provider mount check:');

  // Try to find if providers are mounted
  const root = document.getElementById('__next');
  if (!root) {
    console.log('âŒ React root not found');
    return;
  }

  console.log('âœ… React root exists');
  console.log('');

  // Check localStorage again
  console.log('localStorage check:');
  console.log('  pearl_store_isUserLoggedIn:', localStorage.getItem('pearl_store_isUserLoggedIn'));
  console.log('  pearl_store_selectedService:', localStorage.getItem('pearl_store_selectedService') ? 'âœ… Set' : 'âŒ Not set');
  console.log('');

  // The nuclear option
  console.log('ğŸ”§ If nothing works, try nuclear option:');
  console.log('');
  console.log('A. Stop ALL (daemon + frontend)');
  console.log('B. Clear browser data:');
  console.log('   - Close all localhost:3000 tabs');
  console.log('   - Clear cache in browser settings');
  console.log('C. Restart daemon: ./start_pearl_daemon.sh');
  console.log('D. Restart frontend: yarn dev');
  console.log('E. Open fresh browser tab: http://localhost:3000');
  console.log('F. Login again');
})();


=========================================
